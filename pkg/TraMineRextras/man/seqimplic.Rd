\name{seqimplic}
\alias{seqimplic}
\alias{print.seqimplic}
\alias{plot.seqimplic}
%- Also NEED an '\alias' for EACH other topic documented here.
\title{
Sequence of Typical States
}
\description{
Visualization and identification of the differences between two or more groups of trajectories based on implicative statistic.
}
\usage{
seqimplic(seqdata, group, with.missing = FALSE, weighted = TRUE, na.rm = TRUE)
\method{plot}{seqimplic}(x, title = NULL, ylim = NULL, xaxis = TRUE,
    ylab = "Implication", yaxis = TRUE, axes = "all", xtlab = NULL,
	cex.plot = 1, withlegend = "auto", ltext = NULL, cex.legend = 1,
	legend.prop = NA, rows = NA, cols = NA, siglevel = 0.95, lwd = 1,
	only.levels = NULL, ...)
\method{print}{seqimplic}(x, xtstep = x$xtstep, round = NULL,
    siglevel = NULL, na.print = "", ...)
}
%- maybe also 'usage' for other objects documented here.
\arguments{
\item{seqdata}{a state sequence object (see \code{\link{seqdef}}).}
\item{group}{
a factor giving the group membership of each sequence in \code{seqdata}.
}
\item{with.missing}{Logical. If \code{FALSE} (default), missing values are discarded. If \code{TRUE}, missing values are coded as a specific state.}

\item{weighted}{if \code{TRUE}, implicative strengh of rules are computed using the weights assigned to the state sequence object (see \code{\link{seqdef}}).
  Set as \code{FALSE} if you want ignore the weights.}

\item{na.rm}{
Logical. If \code{TRUE} (default), observations with missing values on the \code{group} variable are discarded. If \code{TRUE}, missing values are coded as a specific state.
}
  \item{x}{
 A sequence of typical state object as generated by \code{seqimplic}.
}
\item{xtstep}{optional interval at which the tick-marks and labels of the x-axis are displayed. For example, with \code{xtstep=3} a tick-mark is drawn at position 1, 4, 7, etc... The display of the corresponding labels depends on the available space and is dealt with automatically. If unspecified, the \code{xtstep} attribute of the \code{x} object is used.}
 \item{title}{title for the graphic. Default is \code{NULL}.}
\item{ylim}{
%%     ~~Describe \code{ylim} here~~
}
\item{xaxis}{if \code{TRUE} (default), the x (time) axis is plotted.}

\item{ylab}{An optional label for the y axis. If set to \code{NA}, no label is drawn.}
\item{yaxis}{Controls whether the y axis is plotted or not. When set to \code{TRUE}, sequence indexes are displayed. }

\item{axes}{if set to \code{"all"} (default value) x axes are drawn for each plot in the graphic. If set to \code{"bottom"}, axes are drawn only under the plots located at the bottom of the graphic area. If \code{FALSE}, no x-axis is drawn.}

\item{xtlab}{optional labels for the x axis ticks labels. If unspecified, the column names of the \code{seqdata} sequence object are used (see \code{\link{seqdef}}).}
\item{cex.plot}{expansion factor for setting the size of the font for the axis labels and names. The default value is 1. Values lesser than 1 will reduce the size of the font, values greater than 1 will increase the size.}

  \item{withlegend}{defines if and where the legend of the state colors is plotted. The default value \code{"auto"} sets the position of the legend automatically. Other possible value is \code{"right"}. Obsolete value \code{TRUE} is equivalent to \code{"auto"}.}

  \item{ltext}{optional description of the states to appear in the legend. Must be a vector of character strings with number of elements equal to the size of the alphabet. If unspecified, the \code{label} attribute of the \code{seqdata} sequence object is used (see \code{\link{seqdef}}).}

  \item{cex.legend}{expansion factor for setting the size of the font for the labels in the legend. The default value is 1. Values lesser than 1 will reduce the size of the font, values greater than 1 will increase the size.}

\item{legend.prop}{sets the proportion of the graphic area used for plotting the legend when \code{use.layout=TRUE} and \code{withlegend=TRUE}. Default value is set according to the place (bottom or right of the graphic area) where the legend is plotted. Values from 0 to 1.}

 \item{rows,cols}{optional arguments to arrange plots when \code{use.layout=TRUE}.}
 \item{lwd}{The line width, a positive number. See \code{\link{lines}}}
  \item{only.levels}{Optional list of levels of the \code{group} variable to be plotted. By default all levels are plotted.}

\item{round}{Optional number of decimals when printing a \code{seqimplic} object.}
  \item{siglevel}{Confidence levels thresholds (default 0.95).}
  \item{na.print}{character string (or \code{NULL}) indicating \code{NA} values in printed output, see \code{\link{print.default}}.}
  \item{\dots}{further arguments passed to \code{\link{print.default}} (for print method) or \code{\link{lines}} (for plot method).}

}
\details{
The \code{seqimplic} function builds a sequence of typical states object. It can be used to visualize or identify the differences between two or more groups of trajectories.
It presents at each time point the typical states of a subpopulation (for instance women, as opposed to men).
A state at a given time point is considered to be typical of a group if the rule "Being in this group implies being in this state at this time point" is relevant according to implicative statistic.

Implicative statistic assesses the statistical relevance of a rule of the form "A implies B".
It does so by measuring the gap between the expected and observed number of counter examples.
If we observe much less counter examples than expected under the independence assumption, the rule is considered to be strongly implicative.
This gap and its significance are computed using adjusted residuals of a contingency table with continuity correction.
In order to improve the readability of the graphs, we use here the opposite of the implicative index which is highly negative for significant rules.
The index  \eqn{I(A\rightarrow B)}{I(A->B)} measuring the relevance of the rule that "A implies B" reads as follows:

\deqn{I(A\rightarrow B)=-\frac{n_{\bar{B}A}+0.5-n^e_{\bar{B}A}}{\sqrt{n^{e}_{\bar{B}A}(n_{B.}/n)(1-n_{.A}/n)}}}{I(A->B) = -(n_\{Bbar,A\}+0.5-n^e_\{Bbar,A\}) / (sqrt\{n^e_\{Bbar,A\}(n_{B.}/n)(1-n_\{.A\}/n)\})}
Where \eqn{n_{\bar{B}A}}{n_\{Bbar,A\}} is the observed number of counter-examples, \eqn{n^{e}_{\bar{B}A}}{e_\{Bbar,A\}} the expected number of counter-examples under the independence assumption,
\eqn{n_{B.}} the number of times that B is observed, \eqn{n_{.A}} the number of times that A is observed and \eqn{n} the total number of cases.

The plot function can be used to visualize the results. It produce a separate plot for each level of the \code{group} variable.
In each plot, it presents at each time point \eqn{t}, the relevance of the rule "Being in this group implies being in this state at this time point".
The higher the value, the higher the relevance of the rule.
The horizontal dashed lines indicate the confidence thresholds. A rule is considered as statistically significant at the 5\% level if it exceeds the 95\% confidence horizontal line.
Rules with negative implicative index are not shown because they have no meaningful interpretation.

}
\value{
\code{seqimplic} returns a \code{"seqimplic"} object that can be plotted and printed. It stores the values of the implicative statistics at each time point.}
\references{
Matthias Studer (2015), Comment: On the Use of Globally Interdependent Multiple Sequence Analysis, Sociological Methodology 45, DOI: 10.1177/0081175015588095.
}
\author{
Matthias Studer.
}

\examples{
data(mvad)

## Building a state sequence object
mvad.seq <- seqdef(mvad, 17:86)
## Sequence of typical states
mvad.si.gcse5eq <- seqimplic(mvad.seq, group=mvad$gcse5eq)

##Plotting the typical states
plot(mvad.si.gcse5eq, lwd=3, siglevel=c(0.95, 0.99))

## Printing the results
print(mvad.si.gcse5eq, xtstep=12)
}
